<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbis Arcana - Level 2</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="container">
        <h1 class="title">Orbis Arcana</h1>
        <h2 class="subtitle">Level 2</h2>

        <p><i>"The more you take, the more you leave behind. What am I?"</i></p>

        <p><strong>Enter the answer to proceed:</strong></p>
        <input type="text" id="answerInput" placeholder="Your answer...">
        <button onclick="checkAnswer()">Submit</button>

        <p id="result"></p>

        <hr>

        <!-- Leaderboard Section -->
        <h2 class="subtitle">Leaderboard</h2>
        <ul id="leaderboard"></ul>

        <hr>

        <!-- Announcements Section -->
        <h2 class="subtitle">Announcements</h2>
        <div id="announcements"></div>
    </div>

    <script type="module">
        // Import Firebase configuration
        import { db } from "./firebase-config.js";
        import { doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

        function checkAnswer() {
            const answer = document.getElementById("answerInput").value.toLowerCase().trim();
            const result = document.getElementById("result");

            if (answer === "footsteps") {
                result.innerHTML = "<span class='correct glow'>Correct! Proceeding to the next level...</span>";
                setTimeout(() => window.location.href = "level3.html", 2000);
            } else {
                result.innerHTML = "<span class='incorrect'>Incorrect. Try again.</span>";
            }
        }

        async function loadLeaderboard() {
            const leaderboard = document.getElementById("leaderboard");
            leaderboard.innerHTML = "";

            const querySnapshot = await getDocs(collection(db, "players"));
            const players = [];

            querySnapshot.forEach(doc => {
                players.push(doc.data());
            });

            players.sort((a, b) => b.level - a.level);

            players.forEach((player, index) => {
                const li = document.createElement("li");
                li.textContent = `#${index + 1} ${player.name} - Level ${player.level}`;
                leaderboard.appendChild(li);
            });
        }

        async function loadAnnouncements() {
            const announcementsDiv = document.getElementById("announcements");
            announcementsDiv.innerHTML = "";

            const docRef = doc(db, "global", "announcements");
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                announcementsDiv.innerHTML = `<p>${docSnap.data().message}</p>`;
            } else {
                announcementsDiv.innerHTML = "<p>No announcements at the moment.</p>";
            }
        }

        loadLeaderboard();
        loadAnnouncements();
    </script>
</body>
</html>
