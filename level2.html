<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbis Arcana - Level 2</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="container">
        <img src="Orbis Arcane.png" alt="Orbis Arcana Logo" class="logo">
        <h1 class="title">Orbis Arcana</h1>
        <h2 class="subtitle">The Second Gate</h2>

        <p><i>"The more you take, the more you leave behind. What am I?"</i></p>
        
        <p><strong>Enter the answer to proceed:</strong></p>
        <input type="text" id="answerInput" placeholder="Your answer...">
        <button id="submitButton" onclick="checkAnswer()">Submit</button>
        <p id="result"></p>

        <!-- Announcements -->
        <h2 class="subtitle">üì¢ Announcements</h2>
        <div id="announcements"></div>

        <!-- Leaderboard Button -->
        <button id="leaderboardButton" onclick="toggleLeaderboard()">üìú View Leaderboard</button>
        <div id="leaderboard" class="hidden"></div>
    </div>

    <script type="module">
        import { db } from "./firebase-config.js";
        import { doc, getDoc, collection, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

        async function checkAnswer() {
            const answer = document.getElementById("answerInput").value.toLowerCase().trim();
            const result = document.getElementById("result");

            if (answer === "footsteps") { 
                result.innerHTML = "<span class='correct glow-text'>Correct! Proceeding to the next challenge...</span>";
                document.getElementById("submitButton").classList.add("glow-button");

                // Simulate a delay before moving to the next level
                setTimeout(() => {
                    window.location.href = "level3.html";
                }, 2000);
            } else {
                result.innerHTML = "<span class='incorrect'>Incorrect. The gate remains closed.</span>";
            }
        }

        // Load Announcements
        async function loadAnnouncements() {
            const announcementsDiv = document.getElementById("announcements");
            announcementsDiv.innerHTML = "Loading...";

            const docRef = doc(db, "global", "announcements");
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                announcementsDiv.innerHTML = `<p>${docSnap.data().message}</p>`;
            } else {
                announcementsDiv.innerHTML = "<p>No announcements at the moment.</p>";
            }
        }

        // Load Leaderboard
        async function loadLeaderboard() {
            const leaderboardDiv = document.getElementById("leaderboard");
            leaderboardDiv.innerHTML = "<p>Loading...</p>";

            const querySnapshot = await getDocs(collection(db, "players"));
            let leaderboardHTML = "<h3>üèÜ Leaderboard</h3><ul>";

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                leaderboardHTML += `<li>${data.name} - Level ${data.level}</li>`;
            });

            leaderboardHTML += "</ul>";
            leaderboardDiv.innerHTML = leaderboardHTML;
        }

        function toggleLeaderboard() {
            const leaderboardDiv = document.getElementById("leaderboard");
            if (leaderboardDiv.classList.contains("hidden")) {
                loadLeaderboard();
                leaderboardDiv.classList.remove("hidden");
            } else {
                leaderboardDiv.classList.add("hidden");
            }
        }

        // Load everything when page opens
        loadAnnouncements();
    </script>
</body>
</html>
